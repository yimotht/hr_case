{% extends "base.html" %}
{% block content %}
<h1>Кабинет HR</h1>

<div class="d-flex gap-2 mb-4">
  <a class="btn btn-primary" href="{{ url_for('hr_create_vacancy') }}">Создать вакансию</a>
</div>

<h2>Мои вакансии</h2>
{% if vacancies %}
  <div class="grid grid-2">
    {% for vacancy in vacancies %}
      <div class="vacancy-card">
        <div class="d-flex justify-between align-center mb-2">
          <h3 class="vacancy-title">{{ vacancy.title }}</h3>
          <span class="badge badge-{% if vacancy.status == 'published' %}success{% elif vacancy.status == 'on_moderation' %}warning{% elif vacancy.status == 'rejected' %}danger{% else %}info{% endif %}">
            {{ vacancy.status }}
          </span>
        </div>
        <p class="mb-1">
          <strong>Откликов:</strong> <span class="accent-text">{{ vacancy.application_count }}</span>
        </p>
        <p class="mb-1">
          <strong>Создана:</strong> {{ vacancy.created_at }}
        </p>
        {% if vacancy.salary_range %}
        <p class="mb-1">
          <strong>Зарплата:</strong> <span class="accent-text">{{ vacancy.salary_range }}</span>
        </p>
        {% endif %}
        <div class="d-flex gap-2 mt-3">
          {% if vacancy.status == 'published' %}
          <form method="post" action="{{ url_for('hr_close_vacancy', vacancy_id=vacancy.id) }}" style="display: inline;">
            <button class="btn btn-secondary" type="submit" onclick="return confirm('Закрыть вакансию? Она будет перемещена в архив.')">Закрыть вакансию</button>
          </form>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="card text-center">
    <h3>У вас пока нет вакансий</h3>
    <p>Создайте первую вакансию, чтобы начать поиск сотрудников.</p>
  </div>
{% endif %}

<h2>Отклики на вакансии</h2>
{% if applications %}
  <div class="grid grid-2">
    {% for app in applications %}
      <div class="vacancy-card">
        <div class="d-flex justify-between align-center mb-2">
          <h4>{{ app.candidate_name }}</h4>
          <span class="badge badge-{% if app.status == 'new' %}warning{% elif app.status == 'viewed' %}info{% elif app.status == 'interview' %}success{% else %}danger{% endif %}">
            {{ app.status }}
          </span>
        </div>
        <p class="mb-1">
          <strong>Вакансия:</strong> {{ app.vacancy_title }}
        </p>
        <p class="mb-1">
          <strong>Дата отклика:</strong> {{ app.created_at }}
        </p>
        {% if app.cover_letter %}
        <div class="mb-2">
          <strong>Сопроводительное письмо:</strong>
          <div class="card" style="margin-top: 5px; padding: 1rem;">
            {{ app.cover_letter }}
          </div>
        </div>
        {% endif %}
        <div class="d-flex gap-2 flex-wrap">
          <a class="btn btn-primary" href="{{ url_for('hr_view_application', application_id=app.id) }}">Подробнее</a>
          <button class="btn btn-secondary" onclick="updateApplicationStatus({{ app.id }}, 'viewed')">Просмотрено</button>
          <button class="btn btn-secondary" onclick="updateApplicationStatus({{ app.id }}, 'interview')">Пригласить на собеседование</button>
          <button class="btn btn-secondary" onclick="updateApplicationStatus({{ app.id }}, 'rejected')">Отклонить</button>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="card text-center">
    <h3>Пока нет откликов</h3>
    <p>Отклики на ваши вакансии будут отображаться здесь.</p>
  </div>
{% endif %}
{% endblock %}
